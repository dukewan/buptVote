function redirect(e){location.href=e}function fancyMessage(e){$.fancybox('<h2 style="text-align:center;width: 320px; height: auto;">'+e+"</h2>")}function showInfo(e,t,n){$("#login").html("");var r="<div id='user_info'>";r+="<span class='user_name'>"+e+"</span><br/>",r+="您还剩余&nbsp;<span class='left_ticket' id='left_ticket'>"+t+"</span>&nbsp;票<br/>",t!=0?r+="<span id='login_text'>赶紧投票支持你喜欢的项目吧！</span>":r+="<span id='login_text'>非常感谢您的支持！</span>",r+="</div>",r+="<div id='button_box'>",r+="<button class='btn btn-large' onclick=redirect('"+n+"')>注销登录</button>",r+="</div>",$("#login").html(r),$("#login").attr("data-logged",1),$("#left_ticket_box_text").html(t),$("#left_ticket_box").fadeToggle(1e3)}function setVoted(e){for(var t=e.length-1;t>=0;t--)$("#btn"+e[t].project_id).html("已投"),$("#btn"+e[t].project_id).attr("class","btn btn-success disabled"),$("#btn"+e[t].project_id).attr("onclick","")}function vote(e){if($("#login").attr("data-logged")!=0)var t=$("#content").attr("data-voteurl"),n=$.ajax({url:t,type:"POST",data:{project_id:e},error:function(e,t,n){fancyMessage("未知错误！")},success:function(){var t=jQuery.parseJSON(n.responseText);if(t.state=="success"){$("#btn"+e).html("已投"),$("#btn"+e).attr("class","btn btn-success disabled"),$("#btn"+e).attr("onclick","");var r=parseInt($("#ticket"+e).html())+1;$("#ticket"+e).html(r);var i=parseInt($("#left_ticket").html())-1;$("#left_ticket").html(i),$("#left_ticket_box_text").html(i),i==0&&($("#login_text").html("非常感谢您的支持！"),fancyMessage("非常感谢您的支持！"))}else t.state=="error"?fancyMessage(t.message):fancyMessage("未知错误！")}});else fancyMessage("请登录后再投票！"),$.scrollTo("#header",1e3)}$(document).ready(function(){$(".fancybox").fancybox(),$("#left_ticket_box").pin({containerSelector:"#content"}),$(".pinned").pin({minWidth:940})}),$(document).ready(function(){$("#login_btn").click(function(){var e=$("#input_name").val();if(!e)return fancyMessage("学号/工号不能为空！"),!1;var t=$("#input_psw").val();if(!t)return fancyMessage("身份证号不能为空！"),!1;var n=$("#login_btn").attr("data-url"),r=$.ajax({url:n,type:"POST",data:{username:e,password:t},error:function(e,t,n){alert(e+" "+t+" "+n)},success:function(){var e=jQuery.parseJSON(r.responseText);e.state=="success"?(fancyMessage(e.message),showInfo(e.name,e.left_ticket,e.logout_url),setVoted(e.voted)):e.state=="error"?fancyMessage(e.message):fancyMessage("未知错误！")}})})}),$("#school_left").click(function(){var e="<span class='btn btn-large choose' id='tel'>信通院</span>&nbsp;<span class='btn btn-large choose' id='cs'>计算机</span>&nbsp;<span class='btn btn-large choose' id='auto'>自动化</span>&nbsp;<span class='btn btn-large choose' id='ele'>电子院</span>&nbsp;<span class='btn btn-large choose' id='math'>理学院</span>&nbsp;<span class='btn btn-large choose' id='hum'>人文院</span>&nbsp;<span class='btn btn-large choose' id='enc'>经管院</span>";$("#school_middle").html(e),$("#school_left").attr("class","school_left2"),$("#school_right").attr("class","school_right"),$(".choose").bind("click",function(){var e=$(this).attr("id");e=="all"?$("."+e).fadeIn(500):($(".all").hide(),$("."+e).fadeIn(500)),$(".choose").attr("class","btn btn-large choose"),$("#"+e).attr("data-toggle","button"),$.scrollTo("#school_box")})}),$("#school_right").click(function(){var e="<span class='btn btn-large choose' id='int'>国际学院</span>&nbsp;<span class='btn btn-large choose' id='soft'>软件学院</span>&nbsp;<span class='btn btn-large choose' id='seven'>七维亦影</span>&nbsp;<span class='btn btn-large choose' id='light'>光研院</span>&nbsp;<span class='btn btn-large choose' id='tuan'>团委</span>&nbsp;<span class='btn btn-large choose' id='sys'>创展服务</span>";$("#school_middle").html(e),$("#school_right").attr("class","school_right2"),$("#school_left").attr("class","school_left"),$(".choose").bind("click",function(){var e=$(this).attr("id");e=="all"?$("."+e).fadeIn(500):($(".all").hide(),$("."+e).fadeIn(500)),$(".choose").attr("class","btn btn-large choose"),$("#"+e).attr("data-toggle","button"),$.scrollTo("#school_box")})}),$(".choose").click(function(){var e=$(this).attr("id");e=="all"?$("."+e).show():($(".all").hide(),$("."+e).fadeIn(500)),$(".choose").attr("class","btn btn-large choose"),$("#"+e).attr("data-toggle","button"),$.scrollTo("#school_box")}),$("#search_go").click(function(){var e=$("#search_keyword").val();$("#project_"+e).length!=0?($(".all").hide(),$("#project_"+e).fadeIn(500)):fancyMessage("您搜索的项目不存在哦~")})